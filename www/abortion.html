async function fetchReproStatus(num){
  // نحاول بدون فرض requireAuth؛ لو الرولز تمنع القراءة، هنلتقط الخطأ ونرجع false
  const col = collection(db,'animals');
  const tenantId = localStorage.getItem('tenantId');
  const uid = auth.currentUser?.uid || null;

  // نبني 6 استعلامات مُحتملة: (field × owner-filter)
  const owners = [
    tenantId ? where('tenantId','==',tenantId) : null,
    uid ? where('userId','==',uid) : null,
    null // بدون فلتر مالك (fallback)
  ].filter(Boolean);

  const fields = ['animalNumber','number']; // وثيقتك فيها number = "108"
  async function tryOne(field, ownerFilter){
    const clauses = [ where(field,'==', String(num)) ];
    if(ownerFilter) clauses.unshift(ownerFilter);
    const qy = query(col, ...clauses, limit(1));
    const snap = await getDocs(qy);
    return snap.empty ? null : snap.docs[0].data();
  }

  let a=null;
  try{
    for (const f of fields){
      for (const o of owners){
        a = await tryOne(f, o);
        if(a) break;
      }
      if(a) break;
    }
    // لو لسه فاضي، آخِر محاولة: بدون أي فلتر مالك لأي من الحقلين
    if(!a){
      for (const f of fields){
        a = await tryOne(f, null);
        if(a) break;
      }
    }
  }catch(e){
    console.warn('read animals failed:', e);
    return {pregnant:false};
  }
  if(!a) return {pregnant:false};

  // توحيد النصوص العربية/الإنجليزية
  const raw = a.reproductiveStatus ?? a.reproStatus ?? a.status ?? a.pregnancyStatus ?? a.pregnancy ?? '';
  const norm = (s)=> String(s)
    .replace(/[\u064B-\u0652]/g,'')   // إزالة التشكيل
    .replace(/[إأآا]/g,'ا')           // توحيد الألف
    .replace(/ة/g,'ه')                // تقريب التاء المربوطة
    .toLowerCase().trim();

  const txt = norm(raw);
  const pregnant = (raw === true) ||
                   /عشار|عشر|حامل|pregnant|preg/.test(txt);

  return {pregnant};
}
