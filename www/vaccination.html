<script>
  document.getElementById("vaccinationForm").addEventListener("submit", async function(e) {
    e.preventDefault();

    const rawInput = document.getElementById("animalIds").value;

    // نحاول تقسيم الإدخالات سواء كانت مفصولة بفواصل أو أسطر
    const ids = rawInput
      .split(/[\n,]+/)
      .map(id => id.replace(/[^\d]/g, '').trim())
      .filter(id => id.length > 0);

    const commonData = {
      date: document.getElementById("date").value,
      vaccineType: document.getElementById("vaccineType").value,
      doseType: document.getElementById("doseType").value,
      vetName: document.getElementById("vetName").value
    };

    let successCount = 0;

    for (let animalId of ids) {
      const data = { ...commonData, animalId };

      try {
        const response = await fetch("https://murabbic-alerts.onrender.com/api/vaccinations", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data)
        });

        if (response.ok) {
          successCount++;
        }
      } catch (error) {
        console.error(`❌ فشل في تسجيل الحيوان ${animalId}:`, error);
      }
    }

    alert(`✅ تم تسجيل التحصين لـ ${successCount} من ${ids.length} حيوان بنجاح`);
    document.getElementById("vaccinationForm").reset();
  });
</script>




