<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      direction: rtl;
      background-color: #fffde9;
      padding: 20px;
    }

    .card {
      background-color: #e9f5e9;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin: auto;
    }

    .card h2 {
      text-align: center;
      color: #2e7d32;
      margin-bottom: 20px;
    }

    .section {
      background-color: #f4fff4;
      padding: 10px 15px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .section strong {
      color: #1b5e20;
    }

    canvas {
      max-width: 100%;
    }

    .back-button {
      display: block;
      text-align: center;
      margin-top: 30px;
    }

    .back-button button {
      background-color: #4caf50;
      color: white;
      padding: 10px 25px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    .back-button button:hover {
      background-color: #388e3c;
    }
  </style>
</head>
<body>

<div class="card" id="card">
  <h2 id="title">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†</h2>

  <div class="section">
    <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> <span id="birthDate"></span><br>
    <strong>Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ:</strong> <span id="season"></span>
  </div>

  <div class="section">
    <strong>Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø­Ù„ÙŠØ¨:</strong> <span id="milkDays"></span> ÙŠÙˆÙ…<br>
    <strong>Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù„Ø¨Ù†:</strong> âœ…<br>
    <span id="milkTotal"></span>
    <canvas id="milkChart" height="300"></canvas>
  </div>

  <div class="section">
    <strong>Ø¹Ù…Ø± Ø§Ù„Ø¹Ø´Ø§Ø±:</strong> <span id="pregnancyAge"></span> ÙŠÙˆÙ…<br>
    <strong>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹:</strong> <span id="expectedCalving"></span>
  </div>

  <div class="section">
    <strong>Ø¢Ø®Ø± Ø­Ø§Ù„Ø© ØµØ­ÙŠØ©:</strong><br>
    <span id="lastHealth"></span>
  </div>
</div>

<div class="back-button">
  <button onclick="window.location.href='dashboard.html'">ğŸ”™ Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ…</button>
</div>

<script>
  const params = new URLSearchParams(window.location.search);
  const number = params.get("number");

  async function loadAnimal() {
    const res = await fetch('data/animals.json');
    const animals = await res.json();
    const animal = animals.find(a => a.number === number);

    if (!animal) {
      document.getElementById("card").innerHTML = "<h2>âŒ Ø§Ù„Ø­ÙŠÙˆØ§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</h2>";
      return;
    }

    document.getElementById("title").textContent = `${animal.type} Ø±Ù‚Ù… (${animal.number})`;
    document.getElementById("birthDate").textContent = animal.birthDate || '---';
    document.getElementById("season").textContent = animal.milkSeason || '---';

    const milkDays = animal.milkDays || 0;
    document.getElementById("milkDays").textContent = milkDays;
    const daily = animal.milkPerDay || 0;
    const monthly = daily * 30;
    const seasonal = daily * milkDays;
    document.getElementById("milkTotal").textContent = `${daily} Ù„ØªØ± ÙŠÙˆÙ…ÙŠÙ‹Ø§ / ${monthly} Ù„ØªØ± Ø´Ù‡Ø±ÙŠÙ‹Ø§ / ${seasonal} Ù„ØªØ± Ù…ÙˆØ³Ù…ÙŠÙ‹Ø§`;

    // Ø±Ø³Ù… Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ
    const ctx = document.getElementById('milkChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: animal.milkGraph?.map((_, i) => `ÙŠÙˆÙ… ${i + 1}`) || [],
        datasets: [{
          label: 'Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù„Ø¨Ù† (Ù„ØªØ±)',
          data: animal.milkGraph || [],
          borderColor: '#2e7d32',
          backgroundColor: '#c8e6c9',
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true,
            title: {
              display: true,
              text: 'Ø§Ù„Ù„ØªØ±Ø§Øª'
            }
          },
          x: {
            title: {
              display: true,
              text: 'ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…'
            }
          }
        }
      }
    });

    document.getElementById("pregnancyAge").textContent = animal.pregnancyAge || '---';
    document.getElementById("expectedCalving").textContent = animal.expectedCalvingDate || '---';
    document.getElementById("lastHealth").textContent = animal.lastHealth || 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ©';
  }

  loadAnimal();
</script>
</body>
</html>
