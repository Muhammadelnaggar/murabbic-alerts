<script>
  // تحميل آخر رقم حيوان من localStorage
  const lastAnimalId = localStorage.getItem("lastAnimalId");
  if (lastAnimalId) {
    document.getElementById("animalId").value = lastAnimalId;
  }

  document.getElementById("milk-form").addEventListener("submit", function (event) {
    event.preventDefault();

    const animalId = document.getElementById("animalId").value;
    const date = document.getElementById("date").value;
    const milking1 = document.getElementById("milking1").value;
    const milking2 = document.getElementById("milking2").value;
    const milking3 = document.getElementById("milking3").value;

    if (!animalId || !date) {
      alert("يرجى إدخال رقم الحيوان والتاريخ");
      return;
    }

    const milkData = {
      animalId,
      date,
      milking1,
      milking2,
      milking3
    };

    fetch("https://murabbic-alerts.onrender.com/api/dailymilk", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(milkData)
    })
      .then(response => {
        if (!response.ok) throw new Error("فشل التسجيل");
        return response.json();
      })
      .then(data => {
        alert("✅ تم تسجيل إنتاج اللبن بنجاح");
        document.getElementById("milk-form").reset();
        document.getElementById("animalId").value = animalId;
      })
      .catch(error => {
        alert("❌ فشل الاتصال بالخادم");
        console.error(error);
      });
  });
</script>
