<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Ø­Ø¯Ø« Ø¬Ø¯ÙŠØ¯ - Ù…Ø±Ø¨ÙŠÙƒ</title>
  <link rel="icon" type="image/svg+xml" href="/images/dashboard.svg">
  <meta name="theme-color" content="#2e7d32" />
  <link rel="stylesheet" href="css/forms.css">
  <script type="module" src="js/forms-init.js"></script>
  <style>
    :root{
      --bg:#f7faf7;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e2e8f0;
      --brand:#0ea05a;
      --brand-600:#0b7f47;
      --danger:#c2410c;
    }
    
    .mbk-top{
      position: sticky; top:0; z-index:50;
      background:#fff;
      border-bottom:1px solid var(--border);
    }
    .mbk-head{
      max-width:980px;
      margin:0 auto;
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    .mbk-title{ line-height:1.1; }
    .mbk-page{ font-size:18px; font-weight:900; color:var(--text); }
    .mbk-app{ font-size:13px; font-weight:900; color:var(--brand-600); opacity:.9; }
    .mbk-logo{ height:46px; width:auto; object-fit:contain; opacity:.95; }

*{box-sizing:border-box}
  body{
  margin:0;
  padding-bottom:70px; /* Ù…Ø³Ø§ÙØ© ØªØ­Øª Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ø´Ø§Ù† Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø¨Ø­Ø§Ø± */
  background:linear-gradient(to bottom,var(--bg1),var(--bg2));
  font-family:'Cairo','Arial',sans-serif;
  color:var(--text);
}
    .meta{padding:8px 10px;text-align:center;font-size:16px}
    .warning{min-height:22px;text-align:center;color:var(--danger);font-size:14px}
    .form{margin:12px;padding:14px;background:var(--card);border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,.08);display:grid;gap:12px}
    .form input{width:100%;padding:12px;border:1px solid #ccc;border-radius:10px;font-size:16px}
   .grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  margin:12px;
}


    @media(min-width:768px){.grid{grid-template-columns:repeat(3,1fr);}}
    .btn{padding:14px;background:#fff;border:1px solid var(--border);border-radius:12px;font-weight:700;cursor:pointer;text-align:center;transition:.2s;box-shadow:0 2px 5px rgba(0,0,0,.06);font-size:16px}
    .btn:hover{background:var(--brand);border-color:var(--brand);color:#fff;transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.12)}
    #inlineMsg{margin:12px;padding:10px;background:#f1f8e9;border:1px solid #c5e1a5;border-radius:10px;display:none}
    #inlineMsg .text{font-size:14px;font-weight:700;color:var(--text);text-align:center}
    /* ===== Ø´Ø±ÙŠØ· Ø¥Ø¨Ø­Ø§Ø± Ø³ÙÙ„ÙŠ ===== */
.mbk-bottom-nav{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  height:58px;
  background:#ffffff;
  border-top:1px solid var(--border);
  display:flex;
  justify-content:space-around;
  align-items:center;
  z-index:9999;
}

.mbk-bottom-nav .mbk-nav-link{
  text-decoration:none;
  padding:8px 14px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#ffffff;
  color:var(--text);
  font-size:0.9rem;
  white-space:nowrap;
}

.mbk-bottom-nav .mbk-nav-link:hover{
  background:var(--green-200);
  color:#fff;
}

.mbk-nav-link-disabled{
  opacity:0.5;
  pointer-events:none;
}

  </style>
</head>
<body>
  <header class="mbk-top">
  <div class="mbk-head">
    <div class="mbk-title">
      <div class="mbk-page">ØªØ³Ø¬ÙŠÙ„ Ø­Ø¯Ø«</div>
      <div class="mbk-app">Ù…ÙØ±ÙØ¨Ù‘ÙÙŠÙƒ</div>
    </div>
    <img class="mbk-logo" src="/images/logo.png" alt="Ù…ÙØ±ÙØ¨Ù‘ÙÙŠÙƒ">
  </div>
</header>
  <div class="meta" id="animalInfo">ğŸ„ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ: ØºÙŠØ± Ù…Ø­Ø¯Ø¯</div>
  <div class="meta" id="dateInfo"></div>
  <div class="warning" id="warn"></div>

  <div class="form">
    <input id="animalNumber" type="text" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù†" inputmode="numeric" />
    <input id="eventDate" type="date" />
  </div>

  <div id="inlineMsg"><div class="text"></div></div>

  <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„Ø£Ø­Ø¯Ø§Ø« -->
  <div class="grid" id="eventButtons">
    <button class="btn" data-page="calving.html">ğŸ‘¶ ÙˆÙ„Ø§Ø¯Ø©</button>
    <button class="btn" data-page="insemination.html">ğŸ“… ØªÙ„Ù‚ÙŠØ­</button>
    <button class="btn" data-page="vaccination.html">ğŸ’‰ ØªØ­ØµÙŠÙ†</button>
    <button class="btn" data-page="dry-off.html">ğŸš« ØªØ¬ÙÙŠÙ</button>
    <button class="btn" data-page="close-up.html">ğŸ¼ ØªØ­Ø¶ÙŠØ± Ù„Ù„ÙˆÙ„Ø§Ø¯Ø©</button>
    <button class="btn" data-page="daily-milk.html">ğŸ¥› Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ù„Ø¨Ù† Ø§Ù„ÙŠÙˆÙ…ÙŠ</button>
    <button class="btn" data-page="nutrition.html">ğŸŒ¿ ØªØºØ°ÙŠØ©</button>
    <button class="btn" data-page="pregnancy-diagnosis.html">ğŸ§ª ØªØ´Ø®ÙŠØµ Ø§Ù„Ø­Ù…Ù„</button>
    <button class="btn" data-page="disease.html">ğŸ”¬ Ø§Ù„ØªØ´Ø®ÙŠØµ</button>
    <button class="btn" id="btnTrimming" data-action="trimming">ğŸ¦¶ ØªÙ‚Ù„ÙŠÙ… Ø§Ù„Ø­ÙˆØ§ÙØ±</button>
    <button class="btn" data-page="abortion.html">ğŸ©¸ Ø¥Ø¬Ù‡Ø§Ø¶</button>
    <button class="btn" data-page="early-fetal-death.html">ğŸ’” Ù…ÙˆØª Ø¬Ù†ÙŠÙ†ÙŠ Ù…Ø¨ÙƒØ±</button>
    <button class="btn" data-page="ovysynch.html">ğŸ“Œ ØªØ²Ø§Ù…Ù† Ø§Ù„ØªØ¨ÙˆÙŠØ¶ ÙˆØ§Ù„ØªÙ„Ù‚ÙŠØ­ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠ</button>
    <button class="btn" data-page="event-list.html">ğŸ“œ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø«</button>
    <!-- Ø¯Ø§Ø®Ù„ grid Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ add-event.html -->
<button class="btn" data-page="heat.html">ğŸ”¥ Ø´ÙŠØ§Ø¹</button>

<button class="btn" data-page="death.html">â˜ ï¸ Ù†ÙÙˆÙ‚</button>

<button class="btn" data-page="cull.html">ğŸš« Ø§Ø³ØªØ¨Ø¹Ø§Ø¯</button>

<button class="btn" data-page="sale.html">ğŸ’° Ø¨ÙŠØ¹</button>



    <!-- Ø²Ø± Ù…ÙˆØ­Ù‘Ø¯ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø°ÙƒÙŠØ© Ø¨Ø¯Ù„ ÙƒÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ù…ØªÙØ±Ù‘Ù‚Ø© -->
    <button class="btn" data-page="smart-camera.html">ğŸ¤– Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø°ÙƒÙŠØ©</button>
  </div>

  <script>window.dataLayer = window.dataLayer || [];</script>
  <script src="/js/app-core.js"></script>
  <script src="/js/tenant-bootstrap.js"></script>
  <script type="module" src="/js/api.js"></script>

  <script>
    function updateCowCardNav(number){
  const link = document.querySelector('[data-nav="cow-card"]');
  if (!link) return;

  if (number){
    link.href = 'cow-card.html?number=' + encodeURIComponent(number);
    link.classList.remove('mbk-nav-link-disabled');
  } else {
    link.href = '#';
    link.classList.add('mbk-nav-link-disabled');
  }
}

  (function(){
    const $ = s=>document.querySelector(s);
    const $$ = s=>document.querySelectorAll(s);
    const norm = v => (v==null||v==='undefined'||v==='null'||v==='NaN')? '' : String(v).trim();
    const todayISO = ()=>{const d=new Date(); d.setMinutes(d.getMinutes()-d.getTimezoneOffset()); return d.toISOString().slice(0,10);};
     const DIGITS = {'Ù ':'0','Ù¡':'1','Ù¢':'2','Ù£':'3','Ù¤':'4','Ù¥':'5','Ù¦':'6','Ù§':'7','Ù¨':'8','Ù©':'9','Û°':'0','Û±':'1','Û²':'2','Û³':'3','Û´':'4','Ûµ':'5','Û¶':'6','Û·':'7','Û¸':'8','Û¹':'9'};
  const toLatinDigits = s => String(s||'').replace(/[Ù -Ù©Û°-Û¹]/g, d => DIGITS[d]).replace(/[^\d]/g,'');
   function hydrate(){
  const qs = new URLSearchParams(location.search);
  const rawDate = norm(qs.get('eventDate') || qs.get('date') || '');
  const date = /^\d{4}-\d{2}-\d{2}$/.test(rawDate) ? rawDate : todayISO();

  const rawNum = norm(qs.get('number') || qs.get('animalNumber') || '');
  const number = toLatinDigits(rawNum);

  $('#dateInfo').textContent = `ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ: ${date}`;
  if (!norm($('#eventDate').value)) $('#eventDate').value = date;

  if (number){
    $('#animalInfo').textContent = `ğŸ„ Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø§Ù„Ø­Ø§Ù„ÙŠ: ${number}`;
    if ($('#animalNumber')) $('#animalNumber').value = number;
  }
updateCowCardNav(number);
}


function ctxOrWarn(){
  const number = toLatinDigits(norm($('#animalNumber').value));
  let date = norm($('#eventDate').value) || todayISO();
  if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) date = todayISO();

  if (!number){
    $('#warn').textContent = 'âš ï¸ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­ÙŠÙˆØ§Ù† Ø£ÙˆÙ„Ù‹Ø§.';
    updateCowCardNav(null);   // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†
    return null;
  }

  $('#warn').textContent = '';
  updateCowCardNav(number);   // ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†
  return { number, date };
}


  function buildUrl(page, ctx){
  const u = new URL(page, location.href);
  u.searchParams.set('number', ctx.number);
  // Ø¯Ø¹Ù… Ø§Ù„ØµÙØ­ØªÙŠÙ†: Ø§Ù„ÙˆÙ„Ø§Ø¯Ø© ÙƒØ§Ù†Øª ØªÙ‚Ø±Ø£ "date"ØŒ ÙˆØ§Ù„ØªÙ„Ù‚ÙŠØ­ ØªÙ‚Ø±Ø£ "eventDate"
  u.searchParams.set('date', ctx.date);
  u.searchParams.set('eventDate', ctx.date);
  return u.toString();
}

    function wireButtons(){
      $$('#eventButtons .btn[data-page]').forEach(btn=>{
        btn.addEventListener('click', e=>{
          e.preventDefault();
          const ctx = ctxOrWarn(); if(!ctx) return;
          const target = btn.getAttribute('data-page');
          if(target){ location.href = buildUrl(target, ctx); }
        }, {passive:true});
       

      });
    }
 const numInput = $('#animalNumber');
if (numInput){
  numInput.addEventListener('input', ()=>{
    const n = toLatinDigits(norm(numInput.value));
    updateCowCardNav(n || null);
  });
}
    async function saveTrimmingInline(){
      const ctx = ctxOrWarn(); if(!ctx) return;
      try{
        const payload = { type:'ØªÙ‚Ù„ÙŠÙ… Ø§Ù„Ø­ÙˆØ§ÙØ±', number:ctx.number, eventDate:ctx.date, source:location.pathname };
        if(typeof window.api?.post === 'function'){
          await window.api.post('/api/events', payload);
        }
        const box = document.getElementById('inlineMsg');
        box.querySelector('.text').textContent = `âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªÙ‚Ù„ÙŠÙ… Ø§Ù„Ø­ÙˆØ§ÙØ± Ù„Ù„Ø­ÙŠÙˆØ§Ù† Ø±Ù‚Ù… ${ctx.number} Ø¨ØªØ§Ø±ÙŠØ® ${ctx.date}.`;
        box.style.display = 'block';
        window.dataLayer.push({event:'event_saved', eventType:'trimming', number:ctx.number, date:ctx.date});
      }catch(err){
        const box = document.getElementById('inlineMsg');
        box.querySelector('.text').textContent = `âŒ ØªØ¹Ø°Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¢Ù†. Ø¬Ø±Ù‘Ø¨ Ù„Ø§Ø­Ù‚Ù‹Ø§.`;
        box.style.display = 'block';
        console.error('Trimming save failed', err);
      }
    }

    function wireTrimming(){
      $('#btnTrimming')?.addEventListener('click', e=>{
        e.preventDefault();
        saveTrimmingInline();
      }, {passive:false});
    }

    hydrate();
    wireButtons();
    wireTrimming();
  })();
  </script>
 <!-- Ø´Ø±ÙŠØ· Ø¥Ø¨Ø­Ø§Ø± Ø³ÙÙ„ÙŠ Ø«Ø§Ø¨Øª -->
<nav class="mbk-bottom-nav">
  <a href="dashboard.html" class="mbk-nav-link">ğŸ  Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</a>
  <a href="#" class="mbk-nav-link mbk-nav-link-disabled" data-nav="cow-card">ğŸ§¾ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­ÙŠÙˆØ§Ù†</a>
</nav>
<script>
(function(){
  "use strict";

  // âœ… Ø§Ù„ØªÙ‚Ø· Ø£ÙŠ Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø±/Ù„ÙŠÙ†Ùƒ Ø§Ù„ØªØ²Ø§Ù…Ù†
  document.addEventListener("click", (e)=>{
    const el = e.target.closest('a,button');
    if (!el) return;

    // Ø²Ø± Ø§Ù„ØªØ²Ø§Ù…Ù†: Ø£ÙŠ Ù„ÙŠÙ†Ùƒ ÙŠÙØªØ­ ovsynch.html Ø£Ùˆ Ø²Ø± Ø¹Ù„ÙŠÙ‡ data-go="ovsynch"
    const href = (el.tagName === "A") ? (el.getAttribute("href") || "") : "";
    const isOvsynch =
      /ovsynch\.html/i.test(href) ||
      (el.getAttribute("data-go") === "ovsynch") ||
      (el.getAttribute("data-target") === "ovsynch");

    if (!isOvsynch) return;

    // âœ… Ø®Ø§Ù†Ø© Ø§Ù„Ø±Ù‚Ù… ÙÙŠ add-event (Ø¬Ø±Ù‘Ø¨ Ø£Ø´Ù‡Ø± ids + fallback Ù„Ø£ÙŠ input Ø±Ù‚Ù…ÙŠ)
    const numEl =
      document.getElementById("number") ||
      document.getElementById("animalNumber") ||
      document.getElementById("animalNumberUI") ||
      document.querySelector('input[name="number"]') ||
      document.querySelector('input[name="animalNumber"]') ||
      document.querySelector('input[type="text"]');

    // âœ… Ø®Ø§Ù†Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ add-event
    const dateEl =
      document.getElementById("date") ||
      document.getElementById("eventDate") ||
      document.querySelector('input[type="date"]');

    const rawNums = String(numEl?.value || "").trim();
    const dt = String(dateEl?.value || "").trim().slice(0,10);

    // Ù„Ùˆ Ù…ÙÙŠØ´ Ø±Ù‚Ù… Ø£Ùˆ ØªØ§Ø±ÙŠØ®ØŒ Ø³ÙŠØ¨ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…
    if (!rawNums || !dt) return;

    // âœ… Ø§Ø³ØªØ®Ø±Ø¬ Ù‚Ø§Ø¦Ù…Ø© Ø£Ø±Ù‚Ø§Ù… (ÙŠØ¯Ø¹Ù…: ÙØ§ØµÙ„Ø©/Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯/Ø›)
    const list = rawNums
      .split(/\n|,|Ø›|;/g)
      .map(s => String(s||"").trim())
      .filter(Boolean);

    // Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ = ÙØ±Ø¯ÙŠ (Ø³ÙŠØ¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù‚Ø¯ÙŠÙ…)
    if (list.length <= 1) return;

    // âœ… Ø¬Ù…Ø§Ø¹ÙŠ: Ø§Ù…Ù†Ø¹ Ø§Ù„Ø³Ù„ÙˆÙƒ Ø§Ù„Ù‚Ø¯ÙŠÙ… ÙˆØ§ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯
    e.preventDefault();
    e.stopPropagation();

    const bulk = encodeURIComponent(list.join(","));
    const url = `ovsynch.html?mbkMode=group&date=${encodeURIComponent(dt)}&bulk=${bulk}`;
    location.href = url;
  }, true);
})();
</script>

</body>
</html>








