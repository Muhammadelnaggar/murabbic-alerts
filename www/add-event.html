<script>
function goToPage(page) {
  const urlParams = new URLSearchParams(window.location.search);

  // دالة لتطبيع القيم (منع undefined/null)
  const norm = v => (v === undefined || v === null || v === 'undefined' || v === 'null' || v === 'NaN')
    ? '' : String(v).trim();

  // الرقم: ناخده من الرابط أو التخزين
  const number = norm(
    urlParams.get('number') ||
    urlParams.get('animalNumber') ||
    localStorage.getItem('currentAnimalNumber') ||
    localStorage.getItem('lastAnimalNumber') ||
    ''
  );

  // التاريخ: ناخده من الرابط أو التخزين، لو مش موجود نحط تاريخ اليوم
  const dateRaw = norm(
    urlParams.get('date') ||
    urlParams.get('eventDate') ||
    localStorage.getItem('lastEventDate') ||
    ''
  );
  const todayISO = new Date().toISOString().slice(0,10);
  const date = dateRaw || todayISO;

  // لو الرقم فاضي، نمنع التنقل
  if (!number) {
    alert('اختَر/أدخل رقم الحيوان أولًا');
    return;
  }

  // جهز الرابط
  const qs = new URLSearchParams({ number, date }).toString();
  const url = `${page}?${qs}`;
  window.location.href = url;
}

// اربط الأزرار
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll("button[data-page]").forEach(btn => {
    btn.addEventListener("click", () => {
      goToPage(btn.getAttribute("data-page"));
    });
  });
});
</script>
