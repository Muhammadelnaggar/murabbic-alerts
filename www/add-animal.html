<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>تسجيل الحيوان</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      direction: rtl;
      background-color: #f9f9f9;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    form {
      max-width: 500px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    select, input[type="text"], input[type="number"], input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      margin-top: 15px;
      padding: 10px;
      width: 100%;
      background-color: #28a745;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #218838;
    }
  </style>
</head>
<body>
  <h2>تسجيل حيوان جديد</h2>
  <form id="animalForm" onsubmit="submitAnimal(event)">
    <label>رقم الحيوان*:
      <input type="text" id="animalId" required />
    </label>

    <label>نوع الحيوان*:
      <select id="animalType" required onchange="updateBreedOptions()">
        <option value="">اختر</option>
        <option value="بقرة">بقرة</option>
        <option value="جاموسة">جاموسة</option>
      </select>
    </label>

    <label>السلالة*:
      <select id="breed" required></select>
    </label>

    <label>الحالة التناسلية*:
      <select id="reproductiveStatus" required onchange="toggleInseminationDate()">
        <option value="">اختر</option>
        <option value="حديثة الولادة">حديثة الولادة</option>
        <option value="ملقحة">ملقحة</option>
        <option value="مفتوحة">مفتوحة</option>
        <option value="عشار">عشار</option>
        <option value="اجهاض">اجهاض</option>
      </select>
    </label>

    <div id="inseminationDateDiv" style="display:none;">
      <label>تاريخ آخر تلقيح:
        <input type="date" id="inseminationDate" />
      </label>
    </div>

    <label>الحالة الإنتاجية*:
      <select id="productionStatus" required onchange="toggleMilkInput()">
        <option value="">اختر</option>
        <option value="حلاب">حلاب</option>
        <option value="جاف">جاف</option>
      </select>
    </label>

    <div id="milkAmountDiv" style="display:none;">
      <label>إنتاج الحليب اليومي (لتر):
        <input type="number" id="milkAmount" />
      </label>
    </div>

    <label>تاريخ الميلاد (اختياري):
      <input type="date" id="birthDate" />
    </label>

    <label>تاريخ آخر ولادة*:
      <input type="date" id="lastBirthDate" required />
    </label>

    <button type="submit">تسجيل الحيوان</button>
  </form>

  <script>
    function updateBreedOptions() {
      const type = document.getElementById("animalType").value;
      const breed = document.getElementById("breed");
      breed.innerHTML = "";

      if (type === "بقرة") {
        ["خليط", "هولشتاين", "جيرسي", "سيمنتال", "مونبليار", "أخرى"].forEach(val => {
          const opt = document.createElement("option");
          opt.value = val;
          opt.textContent = val;
          breed.appendChild(opt);
        });
      } else if (type === "جاموسة") {
        ["مصري", "إيطالي مصري", "هندي مصري"].forEach(val => {
          const opt = document.createElement("option");
          opt.value = val;
          opt.textContent = val;
          breed.appendChild(opt);
        });
      }
    }

    function toggleInseminationDate() {
      const val = document.getElementById("reproductiveStatus").value;
      document.getElementById("inseminationDateDiv").style.display = val === "ملقحة" ? "block" : "none";
    }

    function toggleMilkInput() {
      const val = document.getElementById("productionStatus").value;
      document.getElementById("milkAmountDiv").style.display = val === "حلاب" ? "block" : "none";
    }

    async function submitAnimal(event) {
      event.preventDefault();

      const animal = {
        id: document.getElementById("animalId").value.trim(),
        type: document.getElementById("animalType").value,
        breed: document.getElementById("breed").value,
        reproductiveStatus: document.getElementById("reproductiveStatus").value,
        inseminationDate: document.getElementById("inseminationDate").value,
        productionStatus: document.getElementById("productionStatus").value,
        milkAmount: document.getElementById("milkAmount").value,
        birthDate: document.getElementById("birthDate").value,
        lastBirthDate: document.getElementById("lastBirthDate").value
      };

      try {
        const res = await fetch('https://murabbic-alerts.onrender.com/api/animals', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(animal)
        });

        if (res.ok) {
          const again = confirm("تم التسجيل بنجاح. هل تريد تسجيل حيوان آخر؟");
          if (again) {
            document.getElementById("animalForm").reset();
            document.getElementById("inseminationDateDiv").style.display = "none";
            document.getElementById("milkAmountDiv").style.display = "none";
          } else {
            window.location.href = "add-event.html";
          }
        } else {
          alert("فشل في تسجيل الحيوان.");
        }
      } catch (err) {
        alert("فشل الاتصال بالخادم.");
      }
    }
  </script>
</body>
</html>
