<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ Ù„Ù„Ø­ÙØ¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; padding:24px}
    #card{max-width:520px;margin:auto;border:1px solid #ddd;border-radius:12px;padding:16px}
    #log{margin-top:8px;opacity:.85}
    button{padding:10px 14px;border:0;border-radius:8px;cursor:pointer}
    button[disabled]{opacity:.6;cursor:default}
  </style>
</head>
<body>
  <div id="card">
    <h2>ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹: Ø­ÙØ¸ Ø­Ø¯Ø« ÙÙŠ Firestore</h2>
    <ol>
      <li>Ù‡ÙŠØ­Ø§ÙˆÙ„ ÙŠØ¹Ù…Ù„ Ø¯Ø®ÙˆÙ„ Anonymous ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</li>
      <li>Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± ØªØ­Øª Ø¹Ù„Ø´Ø§Ù† Ù†Ø³Ø¬Ù‘Ù„ Ø­Ø¯Ø« â€œØªØ­ØµÙŠÙ†â€ ØªØ¬Ø±ÙŠØ¨ÙŠ.</li>
    </ol>

    <button id="btnTest">ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø­ÙØ¸</button>
    <div id="log"></div>
  </div>

  <!-- 1) Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø¨ØªØ§Ø¹Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ -->
  <script>
    window.firebaseConfig = {
      apiKey: "PLACEHOLDER",
      authDomain: "PLACEHOLDER.firebaseapp.com",
      projectId: "PLACEHOLDER",
      appId: "PLACEHOLDER"
    };
  </script>

  <!-- 2) Ù…Ù„ÙØ§ØªÙ†Ø§ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© -->
  <script type="module" src="/js/store.js"></script>
  <script type="module" src="/js/smart-tracker.js"></script>

  <!-- 3) Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± -->
  <script type="module">
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.12.1/firebase-auth.js';

    const logEl = document.getElementById('log');
    const btn   = document.getElementById('btnTest');
    const log = (t)=> logEl.textContent = t;

    // Ø¯Ø®ÙˆÙ„ Anonymous Ø¹Ù„Ø´Ø§Ù† Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ØªØ³Ù…Ø­ Ø¨Ø§Ù„Ø­ÙØ¸
    const auth = getAuth();
    onAuthStateChanged(auth, (u)=>{
      if(u){ log('âœ… Ø¯Ø®Ù„Ù†Ø§ Ø¨Ø­Ø³Ø§Ø¨ Anonymous: ' + u.uid.slice(0,8) + 'â€¦'); }
    });
    try {
      await signInAnonymously(auth);
    } catch(e) {
      log('âš ï¸ Ù„Ø§Ø²Ù… ØªÙØ¹Ù‘Ù„ Anonymous Sign-in Ù…Ù† Firebase Console > Authentication > Sign-in method');
      console.error(e);
    }

    // Ø²Ø± Ø§Ù„ØªØ¬Ø±Ø¨Ø©: ÙŠØ­ÙØ¸ Ø­Ø¯Ø« vaccination ØªØ¬Ø±ÙŠØ¨ÙŠ
    btn.addEventListener('click', async ()=>{
      btn.disabled = true; log('Ø¬Ø§Ø±Ù Ø§Ù„Ø­ÙØ¸â€¦');
      try {
        const today = new Date(); const pad = n=>String(n).padStart(2,'0');
        const ymd = `${today.getFullYear()}-${pad(today.getMonth()+1)}-${pad(today.getDate())}`;

        const id = await window.Store.saveEvent({
          animalNumber: 'TEST-123',
          eventDate: ymd,
          type: 'vaccination',
          notes: 'Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ¯ÙˆÙŠ',
          meta: { vaccine:'Demo', boosterDays: 7 }
        });

        log('ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ… (Event ID: ' + id + '). Ø§ÙØªØ­ Firestore ÙˆØ´ÙˆÙÙ‡ ÙÙŠ Ù…Ø¬Ù…ÙˆØ¹Ø© events. ÙˆÙ„Ùˆ smart-tracker Ø´ØºÙ‘Ø§Ù„ØŒ Ù‡ØªÙ„Ø§Ù‚ÙŠ Task booster ÙÙŠ tasks.');
        console.log('âœ… Event saved id =', id);
      } catch(e){
        log('Ø®Ø·Ø£: ' + (e.userFacing ? e.message : (e.message || 'ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø­ÙØ¸')));
        console.error(e);
      } finally {
        btn.disabled = false;
      }
    });

    // Ù„Ùˆ Ù…Ø´ Ø¹Ø§Ù…Ù„ showInlineMessage ÙÙŠ Ù…Ø´Ø±ÙˆØ¹ÙƒØŒ Ø®Ù„Ù‘ÙŠÙ‡Ø§ Console
    window.showInlineMessage ??= (m)=>console.log('INFO:', m);
  </script>
</body>
</html>
