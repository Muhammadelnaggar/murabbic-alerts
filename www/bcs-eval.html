<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>تقييم BCS بالكاميرا — مُرَبِّك</title>
  <style>
    :root{
      --green:#0ea05a; --green-600:#0b7f47; --bg:#f7faf7; --text:#0f172a; --muted:#64748b; --card:#ffffff; --danger:#c2410c;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,'Segoe UI','Cairo',Tahoma,Arial,sans-serif;background:var(--bg);color:var(--text)}
    header{position:sticky;top:0;z-index:10;background:var(--card);border-bottom:1px solid #e2e8f0;padding:12px 16px;display:flex;align-items:center;gap:12px}
    .title{font-weight:800;color:var(--green);margin:0}
    .badge{background:#e6f8ef;color:var(--green-600);padding:4px 8px;border-radius:999px;font-size:12px}
    .container{max-width:860px;margin:16px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid #e2e8f0;border-radius:16px;box-shadow:0 2px 10px rgba(0,0,0,.04)}
    .row{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:860px){.row{grid-template-columns: 1.2fr .8fr}}

    .angles{display:flex;gap:8px;padding:12px;border-bottom:1px solid #e2e8f0}
    .angle-tab{padding:10px 12px;border-radius:999px;border:1px solid #cbd5e1;background:#fff;cursor:pointer;font-weight:700;color:#0f172a;min-height:44px}
    .angle-tab.active{background:var(--green);color:#fff;border-color:var(--green)}

    .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;padding:12px}
    .controls .select,.controls .input{padding:10px 12px;border:1px solid #cbd5e1;border-radius:12px;background:#fff;font-size:16px}
    .controls .btn{padding:12px 14px;border:none;border-radius:12px;cursor:pointer;font-weight:700;min-height:44px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .btn-primary{background:var(--green);color:#fff}
    .btn-light{background:#f1f5f9;color:#0f172a;border:1px solid #cbd5e1}
    .btn-danger{background:var(--danger);color:#fff}
    .btn:disabled{opacity:.6;cursor:not-allowed}

    .preview-wrap{position:relative;border-radius:16px;overflow:hidden;background:#000}
    video#preview{width:100%;height:auto;display:block;background:#000}
    canvas#overlay{position:absolute;inset:0;pointer-events:none}

    .capture-bar{display:flex;gap:8px;padding:12px;border-top:1px solid #e2e8f0;justify-content:space-between}
    .status{display:flex;gap:8px;flex-wrap:wrap}
    .thumb{width:72px;height:72px;border-radius:12px;overflow:hidden;border:2px solid #e2e8f0;background:#f8fafc;position:relative}
    .thumb img{width:100%;height:100%;object-fit:cover}
    .thumb .label{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,.5);color:#fff;font-size:11px;text-align:center}

    .results{padding:12px;border-top:1px solid #e2e8f0;display:grid;gap:10px}
    .score{display:grid;gap:10px;padding:8px;border:1px solid #e2e8f0;border-radius:12px;background:#fff}
    .score-badge{display:inline-block;padding:6px 10px;border:1px solid transparent;border-radius:999px;font-weight:800;width:max-content}
    .score-bar{height:10px;background:#f1f5f9;border:1px solid #e2e8f0;border-radius:999px;overflow:hidden}
    .score-bar .fill{height:100%}
    .score-note{color:var(--muted);font-weight:700}

    .save-bar{display:flex;gap:8px;align-items:center;padding:12px;border-top:1px solid #e2e8f0}
    .save-bar .input{padding:10px 12px;border:1px solid #cbd5e1;border-radius:12px;background:#fff;font-size:16px}

    /* إطفاء أي طبقة محرر غريبة */
    editor-card,.editor-card{pointer-events:none !important;opacity:0 !important;visibility:hidden !important;position:static !important;z-index:-1 !important}
    header,.container,#cameraCard{position:relative;z-index:1}
  </style>
</head>
<body>
  <header>
    <h1 class="title">تقييم BCS بالكاميرا</h1>
    <span class="badge">مُرَبِّك</span>
    <span class="badge" id="demoBadge" style="display:none;background:#fff3cd;color:#92400e;border:1px solid #facc15">وضع العرض</span>
    <div style="margin-inline-start:auto;color:var(--muted);font-weight:700">رقم الحيوان: <span class="animal-number">—</span></div>
  </header>

  <div class="container row">
    <section class="card" id="cameraCard">
      <div class="angles">
        <button class="angle-tab active" data-angle="side">لقطة جانبية</button>
        <button class="angle-tab" data-angle="rear">لقطة خلفية</button>
      </div>

      <div class="controls">
        <select id="cameraSelect" class="select" title="اختيار الكاميرا"></select>
        <button id="demoBtn" class="btn btn-light" title="تشغيل وضع العرض">وضع العرض</button>
        <button id="toggleFlash" class="btn btn-light" title="تشغيل الفلاش" aria-pressed="false">الفلاش</button>
        <button id="restartBtn" class="btn btn-light">إعادة التهيئة</button>
        <div style="margin-inline-start:auto"></div>
        <button id="captureBtn" class="btn btn-primary">التقاط</button>
        <button id="retakeBtn" class="btn btn-danger" disabled>إعادة الالتقاط</button>
        <button id="uploadBtn" class="btn btn-light">رفع صورة بديلة</button>
        <input id="uploadInput" type="file" accept="image/*" style="display:none" />
        <button id="nextAngleBtn" class="btn btn-light">التالي ▸</button>
      </div>

      <div class="preview-wrap">
        <video id="preview" playsinline autoplay muted></video>
        <canvas id="overlay"></canvas>
      </div>

      <div class="capture-bar">
        <div class="status" id="thumbs"></div>
        <div class="helper" id="helperText">التقط <strong>لقطة جانبية</strong> تُظهر الـ tail fold وموضع الـ pin bone قدر الإمكان.</div>
      </div>
    </section>

    <aside class="card">
      <div class="results" id="resultsBox">
        <h3 style="margin:8px 0;color:var(--green-600)">نتيجة BCS</h3>
        <div id="scoreWidget" class="score">
          <div class="score-badge" id="scoreBadge">—</div>
          <div class="score-bar"><div class="fill" id="scoreFill" style="width:0%"></div></div>
          <div class="score-note" id="scoreNote">ارفع/التقط صورتي <b>جانبية</b> و/أو <b>خلفية</b>. الدرجات: 2 — 2.75 — <b>3 (مثالي)</b> — 3.25 — 4 — 5.</div>
        </div>
      </div>

      <div class="save-bar">
        <input type="hidden" id="animalId" />
        <label style="display:flex;gap:8px;align-items:center">تاريخ التقييم
          <input type="date" id="eventDate" class="input" />
        </label>
        <div style="margin-inline-start:auto"></div>
        <button id="saveBtn" class="btn btn-primary">حفظ التقييم</button>
      </div>
    </aside>
  </div>

<script type="module">
  // ===== Helpers & context =====
  const qs = new URLSearchParams(location.search);
  const $ = (s,p=document)=>p.querySelector(s);
  const $$ = (s,p=document)=>[...p.querySelectorAll(s)];
  const isDemo = qs.get('demo')==='1' || qs.get('mode')==='demo';

  function todayCairo(){ const now=new Date(new Date().toLocaleString('en-US',{timeZone:'Africa/Cairo'})); const y=now.getFullYear(), m=String(now.getMonth()+1).padStart(2,'0'), d=String(now.getDate()).padStart(2,'0'); return `${y}-${m}-${d}`; }
  function getAnimalFromContext(){
    const id=qs.get('animalId')||localStorage.getItem('currentAnimalId')||'';
    const number=qs.get('number')||localStorage.getItem('currentAnimalNumber')||'';
    const date=qs.get('date')||sessionStorage.getItem('currentEventDate')||localStorage.getItem('currentEventDate')||todayCairo();
    if(id) localStorage.setItem('currentAnimalId',id);
    if(number) localStorage.setItem('currentAnimalNumber',number);
    if(date){ localStorage.setItem('currentEventDate',date); sessionStorage.setItem('currentEventDate',date); }
    return {id,number,date};
  }

  const preview=$('#preview'), overlay=$('#overlay'), cameraSelect=$('#cameraSelect');
  const toggleFlash=$('#toggleFlash'), restartBtn=$('#restartBtn');
  const captureBtn=$('#captureBtn'), retakeBtn=$('#retakeBtn'), nextAngleBtn=$('#nextAngleBtn');
  const uploadBtn=$('#uploadBtn'), uploadInput=$('#uploadInput');
  const scoreBadge=$('#scoreBadge'), scoreFill=$('#scoreFill'), scoreNote=$('#scoreNote');
  const saveBtn=$('#saveBtn'), animalIdInput=$('#animalId'), eventDateInput=$('#eventDate');
  const numberSpan=document.querySelector('.animal-number');

  const helperByAngle={
    side:'التقط <strong>لقطة جانبية</strong>؛ يُفضّل إظهار الـ tail fold وموضع الـ pin bone ومساحة الأضلاع.',
    rear:'التقط <strong>لقطة خلفية</strong>؛ ركّز على الـ tail head و الـ pin bones.'
  };

  const state={ stream:null, track:null, capabilities:null, torchOn:false,
    currentAngle:'side',
    captures:{ side:null, rear:null },
    lastScore:null
  };

  // ===== Camera & overlay =====
  function fitOverlay(){ const r=preview.getBoundingClientRect(); overlay.width=r.width*devicePixelRatio; overlay.height=r.height*devicePixelRatio; overlay.style.width=r.width+'px'; overlay.style.height=r.height+'px'; }
  function drawGuide(){
    const g=overlay.getContext('2d'); if(!g) return;
    const w=overlay.width,h=overlay.height;
    g.clearRect(0,0,w,h);
    g.strokeStyle='rgba(255,255,255,.35)'; g.lineWidth=1*devicePixelRatio;
    for(let i=1;i<3;i++){ g.beginPath(); g.moveTo((w/3)*i,0); g.lineTo((w/3)*i,h); g.stroke();
                          g.beginPath(); g.moveTo(0,(h/3)*i); g.lineTo(w,(h/3)*i); g.stroke(); }
    g.strokeStyle='rgba(14,160,90,.9)'; g.lineWidth=4*devicePixelRatio;
    let rx=w*.12, ry=h*.12, rw=w*.76, rh=h*.76;
    if(state.currentAngle==='side'){ rx=w*.08; ry=h*.15; rw=w*.84; rh=h*.7; }
    if(g.roundRect){ g.beginPath(); g.roundRect(rx,ry,rw,rh,20*devicePixelRatio); g.stroke(); } else { g.strokeRect(rx,ry,rw,rh); }
  }

  async function listCameras(){ const devs=await navigator.mediaDevices.enumerateDevices(); const cams=devs.filter(d=>d.kind==='videoinput'); cameraSelect.innerHTML=''; cams.forEach((c,i)=>{ const o=document.createElement('option'); o.value=c.deviceId; o.textContent=c.label||`كاميرا ${i+1}`; cameraSelect.appendChild(o); }); return cams; }
  async function startCamera(deviceId){ if(state.stream){ state.stream.getTracks().forEach(t=>t.stop()); } const cs=deviceId?{video:{deviceId:{exact:deviceId}}}:{video:{facingMode:{ideal:'environment'}}}; const stream=await navigator.mediaDevices.getUserMedia(cs); state.stream=stream; preview.srcObject=stream; const [track]=stream.getVideoTracks(); state.track=track; state.capabilities=track.getCapabilities?.()||null; await preview.play(); fitOverlay(); drawGuide(); populateTorchSupport(); }
  function populateTorchSupport(){ const cap=state.capabilities; toggleFlash.disabled=!(cap&&'torch' in cap); }
  async function toggleTorch(){ try{ if(!state.track) return; state.torchOn=!state.torchOn; await state.track.applyConstraints({advanced:[{torch:state.torchOn}]}); toggleFlash.setAttribute('aria-pressed',String(state.torchOn)); toggleFlash.textContent=state.torchOn?'الفلاش: يعمل':'الفلاش'; }catch(e){ console.warn('Torch not supported',e); } }
  function dataURLFromVideo(){ const c=document.createElement('canvas'); const w=preview.videoWidth,h=preview.videoHeight; c.width=w; c.height=h; c.getContext('2d').drawImage(preview,0,0,w,h); return c.toDataURL('image/jpeg',0.92); }

  // ===== Hidden reference images (side+rear for each score) =====
  // استخدم مسار نسبي "images/" من نفس مجلد الصفحة (www/)
  const REF_BASE = 'images/';
  const REF_EXTS = ['jpg','jpeg','png','webp','JPG','JPEG','PNG','WEBP'];

  const BSC_LEVELS = [
    {score:2,    side:'bsc2_side',    rear:'bsc2_rear'},
    {score:2.75, side:'bsc2_75_side', rear:'bsc2_75_rear'},
    {score:3,    side:'bsc3_side',    rear:'bsc3_rear'},
    {score:3.25, side:'bsc3_25_side', rear:'bsc3_25_rear'},
    {score:4,    side:'bsc4_side',    rear:'bsc4_rear'},
    {score:5,    side:'bsc5_side',    rear:'bsc5_rear'},
  ];

  function tryUrls(base){ return REF_EXTS.map(ext=> `${REF_BASE}${base}.${ext}`); }

  function imgToVec(img){ const w=64,h=64; const c=document.createElement('canvas'); c.width=w; c.height=h; const g=c.getContext('2d'); g.drawImage(img,0,0,w,h);
    const d=g.getImageData(0,0,w,h).data; const v=new Float32Array(w*h); let k=0;
    for(let i=0;i<d.length;i+=4){ v[k++]=0.2126*d[i]+0.7152*d[i+1]+0.0722*d[i+2]; }
    // normalize
    let mean=0; for(let i=0;i<v.length;i++) mean+=v[i]; mean/=v.length;
    let norm=0; for(let i=0;i<v.length;i++){ v[i]-=mean; norm+=v[i]*v[i]; } norm=Math.sqrt(norm)||1;
    for(let i=0;i<v.length;i++) v[i]/=norm;
    return v;
  }

  function loadOneVector(urls){
    let i=0;
    return new Promise(res=>{
      function go(){
        if(i>=urls.length) return res(null);
        const img=new Image();
        try{ const abs=new URL(urls[i], location.href); if(abs.origin!==location.origin) img.crossOrigin='anonymous'; }catch{}
        img.onload=()=>res(imgToVec(img));
        img.onerror=()=>{ i++; go(); };
        img.src=urls[i];
      }
      go();
    });
  }

  const refVectorsPromise = (async ()=>{
    const out=[];
    for(const lvl of BSC_LEVELS){
      const sideVec = await loadOneVector(tryUrls(lvl.side));
      const rearVec = await loadOneVector(tryUrls(lvl.rear));
      out.push({ score:lvl.score, sideVec, rearVec });
    }
    const haveAny = out.some(r=>r.sideVec||r.rearVec);
    if(!haveAny && scoreNote){
      scoreNote.textContent = 'تنبيه: لم يتم تحميل المراجع من images/ — راجع أسماء الملفات.';
    }
    return out;
  })();

  function cosine(a,b){ let s=0; for(let i=0;i<a.length;i++) s+=a[i]*b[i]; return s; }
  function vecFromDataURL(dataUrl){
    return new Promise(res=>{
      const img=new Image(); img.onload=()=>res(imgToVec(img)); img.src=dataUrl;
    });
  }

  async function scoreBCS(sideUrl, rearUrl){
    const refs = await refVectorsPromise;
    if(!refs.length) return 3;
    const sideVec = sideUrl ? await vecFromDataURL(sideUrl) : null;
    const rearVec = rearUrl ? await vecFromDataURL(rearUrl) : null;

    let best = null;
    for(const r of refs){
      let sim = 0, parts = 0;
      if(sideVec && r.sideVec){ sim += cosine(sideVec, r.sideVec); parts++; }
      if(rearVec && r.rearVec){ sim += cosine(rearVec, r.rearVec); parts++; }
      if(parts===0) continue; // لا مقارنة ممكنة لهذا المستوى
      const avg = sim/parts;
      if(!best || avg>best.sim){ best = {score:r.score, sim:avg}; }
    }
    return best ? best.score : 3;
  }

  function renderBCS(s){
    let label='';
    if(s===3) label='مثالية';
    else if(s<3) label='تميل للنحافة';
    else label='تميل للسمنة';
    scoreBadge.textContent = `${label} — ${s}`;
    const pct = Math.min(100, Math.max(0, (s/5)*100)); // مقياس بصري تقريبي
    scoreFill.style.width = pct+'%';
    scoreFill.style.background = (s===3) ? '#86efac' : '#7dd3fc';
    state.lastScore = s;
  }

  // ===== UI =====
  const thumbs=$('#thumbs'), helperText=$('#helperText');
  function renderThumbs(){
    thumbs.innerHTML='';
    for(const a of ['side','rear']){
      const wrap=document.createElement('div'); wrap.className='thumb';
      const img=document.createElement('img'); if(state.captures[a]) img.src=state.captures[a];
      wrap.appendChild(img);
      const lb=document.createElement('div'); lb.className='label'; lb.textContent = (a==='side'?'جانبية':'خلفية');
      wrap.appendChild(lb);
      wrap.title = (a==='side'?'جانبية':'خلفية');
      wrap.addEventListener('click', ()=> setAngle(a));
      thumbs.appendChild(wrap);
    }
  }
  function setAngle(a){
    state.currentAngle=a;
    $$('.angle-tab').forEach(el=> el.classList.toggle('active', el.dataset.angle===a));
    helperText.innerHTML = helperByAngle[a];
    drawGuide();
    updateButtons();
  }
  function updateButtons(){ retakeBtn.disabled = !state.captures[state.currentAngle]; }

  // bindings
  window.addEventListener('resize', ()=>{ fitOverlay(); drawGuide(); });
  $$('.angle-tab').forEach(btn=> btn.addEventListener('click', ()=> setAngle(btn.dataset.angle)));
  nextAngleBtn.addEventListener('click', ()=>{ setAngle(state.currentAngle==='side'?'rear':'side'); });

  const dropInput=uploadInput;
  uploadBtn.addEventListener('click', ()=> dropInput && dropInput.click());
  dropInput.addEventListener('change', async (e)=>{
    const f=e.target.files && e.target.files[0]; if(!f) return;
    const r=new FileReader();
    r.onload=async ()=>{ state.captures[state.currentAngle]=r.result; renderThumbs(); updateButtons();
      const s = await scoreBCS(state.captures.side, state.captures.rear); renderBCS(s);
    };
    r.readAsDataURL(f); dropInput.value='';
  });

  toggleFlash.addEventListener('click', toggleTorch);
  restartBtn.addEventListener('click', async ()=>{ await startCamera(cameraSelect.value); });
  cameraSelect.addEventListener('change', async ()=>{ await startCamera(cameraSelect.value); });

  captureBtn.addEventListener('click', async ()=>{
    const url=dataURLFromVideo();
    state.captures[state.currentAngle]=url;
    renderThumbs(); updateButtons();
    const s = await scoreBCS(state.captures.side, state.captures.rear);
    renderBCS(s);
  });

  retakeBtn.addEventListener('click', async ()=>{
    state.captures[state.currentAngle]=null;
    renderThumbs(); updateButtons();
    const s = await scoreBCS(state.captures.side, state.captures.rear);
    renderBCS(s);
  });

  // ===== حفظ التقييم =====
  saveBtn.addEventListener('click', async ()=>{
    try{
      if(state.lastScore==null){ alert('التقط أو ارفع صورة واحدة على الأقل أولًا.'); return; }
      saveBtn.disabled=true; saveBtn.textContent='جارٍ الحفظ…';
      const ctx=getAnimalFromContext();
      if(animalIdInput) animalIdInput.value = animalIdInput.value || ctx.id || '';
      if(eventDateInput) eventDateInput.value = eventDateInput.value || ctx.date || todayCairo();
      const animalId = (animalIdInput && animalIdInput.value.trim()) || ctx.id || 'unknown';
      const date = (eventDateInput && eventDateInput.value) || ctx.date || todayCairo();

      if(isDemo){
        const doc={ type:'تقييم BCS بالكاميرا (عرض)', animalId, date, bcsScore: state.lastScore, images:{side:state.captures.side||null, rear:state.captures.rear||null}, createdAt: Date.now() };
        localStorage.setItem('murabbik_bcs_demo_last', JSON.stringify(doc));
        alert('تم الحفظ محليًا (وضع العرض).');
      }else{
        try{
          const { db, storage, serverTimestamp, addDoc, collection, ref, uploadString, getDownloadURL } = await import('./js/firebase-config.js');
          const uploaded={};
          if(state.captures.side){ const r=ref(storage, `bcs-evaluations/${animalId}/${date}/side.jpg`); await uploadString(r, state.captures.side, 'data_url'); uploaded.side=await getDownloadURL(r); }
          if(state.captures.rear){ const r=ref(storage, `bcs-evaluations/${animalId}/${date}/rear.jpg`); await uploadString(r, state.captures.rear, 'data_url'); uploaded.rear=await getDownloadURL(r); }
          const doc={ type:'تقييم BCS بالكاميرا', animalId, date, bcsScore: state.lastScore, images: uploaded, createdAt: serverTimestamp() };
          await addDoc(collection(db,'events'), doc);
          alert('تم الحفظ ورفع الصور.');
        }catch(err){ console.warn(err); alert('تعذّر الحفظ السحابي؛ تم الحفظ محليًا.'); localStorage.setItem('murabbik_bcs_last', JSON.stringify({animalId,date,score:state.lastScore,side:state.captures.side||null,rear:state.captures.rear||null,at:Date.now()})); }
      }
    }finally{
      saveBtn.disabled=false; saveBtn.textContent='حفظ التقييم';
    }
  });

  // ===== Demo: يحمّل صور المرجع 3 (مثالي) إن وُجدت =====
  async function runDemo(){
    const badge=$('#demoBadge'); if(badge) badge.style.display='inline-block';
    const idealSide = tryUrls('bsc3_side')[0];
    const idealRear = tryUrls('bsc3_rear')[0];
    try{
      const imgS=new Image(), imgR=new Image();
      await new Promise((ok)=>{ let c=0; function done(){ if(++c===2) ok(); }
        imgS.onload=done; imgR.onload=done;
        imgS.src=idealSide; imgR.src=idealRear;
      });
      const cs=document.createElement('canvas'); cs.width=imgS.width; cs.height=imgS.height; cs.getContext('2d').drawImage(imgS,0,0); state.captures.side=cs.toDataURL('image/jpeg',0.9);
      const cr=document.createElement('canvas'); cr.width=imgR.width; cr.height=imgR.height; cr.getContext('2d').drawImage(imgR,0,0); state.captures.rear=cr.toDataURL('image/jpeg',0.9);
      renderThumbs();
      renderBCS(await scoreBCS(state.captures.side, state.captures.rear));
    }catch{ renderBCS(3); }
  }

  // ===== Init =====
  (async function init(){
    const ctx=getAnimalFromContext();
    if(animalIdInput) animalIdInput.value = ctx.id || '';
    if(eventDateInput) eventDateInput.value = ctx.date || todayCairo();
    if(numberSpan) numberSpan.textContent = ctx.number || (ctx.id ? `#${ctx.id.slice(-5)}` : '—');

    renderThumbs(); setAngle('side');

    try{
      if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia){
        alert('المتصفح لا يدعم تشغيل الكاميرا عبر الويب.');
      }
      if(location.protocol!=='https:' && location.hostname!=='localhost'){
        console.warn('يُنصح باستخدام https لتشغيل الكاميرا. سيتم تفعيل وضع العرض عند الحاجة.');
      }
      await startCamera(); await listCameras();
      if(!cameraSelect.value && cameraSelect.options.length){ cameraSelect.value=cameraSelect.options[0].value; }
    }catch(e){ console.warn(e); }

    // زر وضع العرض
    $('#demoBtn')?.addEventListener('click', runDemo);
    if(isDemo) runDemo();
  })();
</script>

<script>
  // إزالة أي عنصر "editor-card" لو ظهر فجأة
  function nukeEditorCard(){ document.querySelectorAll('editor-card,.editor-card').forEach(n=>{ try{ n.remove(); }catch{} }); }
  new MutationObserver(nukeEditorCard).observe(document.documentElement,{childList:true,subtree:true});
  document.addEventListener('DOMContentLoaded', nukeEditorCard);
</script>
</body>
</html>
